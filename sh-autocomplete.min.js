/*!
 * shAutocomplete v0.2 (2017-11-01)
 * Autocomplete Bootstrap jQuery plugin
 * https://github.com/sunhater/shAutocomplete
 *
 * Copyright (c) 2017 Pavel Tzonkov <sunhater@sunhater.com>
 * Dual licensed under the MIT and GPL licenses
 */
(function(a){a.fn.autocomplete=function(d){var h={bootstrapVersion:3,timeout:1000,maxHeight:null,bottomSpace:20,requestUrl:"request.json?q=",debug:false,autofill:function(i,j){a.ajax({method:"get",dataType:"json",url:h.requestUrl+encodeURIComponent(i.value),success:function(k){j(k)},error:function(){j();if(h.debug){console.log("shAutofill search request failed!")}}})},choose:function(i,j){},input:function(i){},transfer:function(i,j){a(i).val(a(j).text())}};a.extend(true,h,d);var c=function(){var l=a(".shac.open .shac-menu, .shac-menu.show");if(!l.length){return}l.css({height:"auto"});var m=l.offset(),k=parseInt(l.css("margin-top")),o=l.outerHeight(),j=m.top+o+k+h.bottomSpace,n=Math.max(document.documentElement.clientHeight,window.innerHeight||0);if(j>=n){var i=n-m.top-k-h.bottomSpace-1;l.css({height:i})}},b=function(i){if(h.bootstrapVersion==3){a(i).addClass("open")}else{if(h.bootstrapVersion==4){a(i).addClass("show");a(i).find(".shac-menu").addClass("show")}}},g=function(i){a(i).find(".shac-menu").scrollTop(0);a(i).find("input").removeData("active");if(h.bootstrapVersion==3){a(i).removeClass("open")}else{if(h.bootstrapVersion==4){a(i).removeClass("show");a(i).find(".shac-menu").removeClass("show")}}},e=function(j,i){if(h.bootstrapVersion==3){return'<li data-id="'+j+'" class="shac-item"><a href="javascript:;">'+i+"</a></li>"}else{if(h.bootstrapVersion==4){return'<li data-id="'+j+'" class="shac-item dropdown-item">'+i+"</li>"}}};a(window).off("click.shac").on("click.shac",function(){g(".shac")}).off("resize.shac").on("resize.shac",c);a("body").on("click.shac",".bs-dropdown, .shac input",function(i){i.stopPropagation()});var f=h.bootstrapVersion==3?5:8;a(this).wrap('<div class="shac" />').after('<ul class="shac-menu dropdown-menu" />').each(function(){var i=0,k=false,j=a(this).parent(),l=j.find(".shac-menu");a(this).on("input.shac",function(){var m=this;g(j);i++;if(h.debug){console.log("Input: "+this.value)}h.input(this);setTimeout(function(){i--;if(i||k){return}k=true;if(h.debug){console.log("Search: "+m.value)}h.autofill(m,function(o){if(o===undefined){k=false;return}if(a.isEmptyObject(o)){return}l.html("");if(h.maxHeight){l.css({maxHeight:h.maxHeight})}for(var n in o){l.append(e(n,o[n]))}l.find(".shac-item").click(function(){if(h.debug){console.log(a(this).data())}h.choose(m,this);g(j);h.transfer(m,this)});b(j);setTimeout(c,0);k=false})},h.timeout)})}).keydown(function(w){var l,z=a(this).data(),k=a(this).next(),u=a(this).parent(),j=k.find(".shac-item").length,v=(w.keyCode===13),i=(w.keyCode===27),x=(w.keyCode===38),t=(w.keyCode===40);if(v){if(z.active===undefined){return true}var n=k.find(".shac-item").eq(z.active);if(h.debug){console.log(n.data())}h.choose(this,n);h.transfer(this,n);g(u);return false}if(i){g(u);return}if(x){if(z.active===undefined){l=j-1}else{l=z.active;l--;if(l<0){l=j-1}}}if(t){if(z.active===undefined){l=0}else{l=z.active;l++;if(l>=j){l=0}}}if(x||t){var p=k.find(".shac-item").eq(l),q=k.innerHeight(),o=k.scrollTop(),y=k.prop("scrollHeight"),A=p.position().top+o,s=p.outerHeight(),m=A+s+f,r=A-f;a(this).data({active:l});k.find(".shac-item").removeClass("key-active");p.addClass("key-active");if(y>q){k.scrollTop(x?r:(m-q))}return false}})}})(jQuery);