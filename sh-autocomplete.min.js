/*!
 * shAutocomplete v0.4 (2017-11-03)
 * Autocomplete Bootstrap jQuery plugin
 * https://github.com/sunhater/shAutocomplete
 *
 * Copyright (c) 2017 Pavel Tzonkov <sunhater@sunhater.com>
 * Dual licensed under the MIT and GPL licenses
 */
(function(a){a.fn.autocomplete=function(j){var c={request:{url:"",method:"get",dataType:"json",queryParam:"q"},timeout:1000,minChars:3,normalizeQuery:true,limit:null,cache:true,maxHeight:null,minHeight:82,bottomSpace:20,bootstrapVersion:3,debug:false,choose:function(k,l){},searchStart:function(k){},searchEnd:function(k){},input:function(k){},result:function(k){return k},transfer:function(k){return a(k).text()},autofill:function(k,l){f(k,l)}};a.extend(true,c,j);var h=(c.bootstrapVersion==3);BOOTSTRAP4=(c.bootstrapVersion==4);if(!h&&!BOOTSTRAP4){alert("shAutocomplete: Bootstrap versions 3 and 4 are supported only!");return}var f=function(k,n){var l=jQuery.extend(true,{},c.request),m={};m[l.queryParam]=k.value;delete l.queryParam;if((l.data===undefined)||(typeof l.data!=="object")||(l.data!==Object(l.data))){l.data=m}else{a.extend(true,l.data,m)}l.success=function(o){n(c.result(o))};l.error=function(q,o,p){n();if(c.debug){console.log("shAutofill search request failed!",o,p,q)}};a.ajax(l)},d=function(){var m=a(".shac.open .shac-menu, .shac-menu.show");if(!m.length){return}m.css({height:"auto"});var l=parseInt(m.css("margin-top")),o=m.offset().top,q=m.outerHeight(),p=window.innerHeight,n=document.documentElement.clientHeight,k=p-o-l-c.bottomSpace;if(p<n){k+=a(document).scrollTop()}if(k<c.minHeight){k=c.minHeight}if(k<q){m.css({height:k})}},g=function(k){if(h){a(k).addClass("open")}else{a(k).addClass("show");a(k).find(".shac-menu").addClass("show")}},i=function(k){a(k).find(".shac-menu").scrollTop(0);a(k).find("input").removeData("active");if(h){a(k).removeClass("open")}else{a(k).removeClass("show");a(k).find(".shac-menu").removeClass("show")}},e=function(l,k){return h?'<li data-id="'+l+'" class="shac-item"><a>'+k+"</a></li>":'<li data-id="'+l+'" class="shac-item dropdown-item">'+k+"</li>"};a(window).off("click.shac").on("click.shac",function(){i(".shac")}).off("resize.shac scroll.shac").on("resize.shac scroll.shac",d);a("body").on("click.shac",".shac-menu, .shac input",function(k){k.stopPropagation()});var b=h?5:8;a(this).wrap('<div class="shac" />').after('<ul class="shac-menu dropdown-menu" />').each(function(){var k=0,n=[],m=false,l=a(this).parent(),o=l.find(".shac-menu");a(this).on("input.shac",function(){var p=this;i(l);k++;if(c.debug){console.log("Input: "+this.value)}c.input(this);setTimeout(function(){k--;if(k||m||(a(p).val().replace(/\s+/g,"").length<c.minChars)){return}m=true;a(p).prop({readonly:true});if(c.normalizeQuery){a(p).val(p.value.replace(/^\s+/,"").replace(/\s+$/,"").replace(/\s+/g," "))}c.searchStart(p);if(c.debug){console.log("Search: "+p.value)}var q=function(s){o.html("");if(c.maxHeight){o.css({maxHeight:c.maxHeight})}for(var r in s){o.append(e(r,s[r]))}o.find(".shac-item").click(function(){if(c.debug){console.log(a(this).data())}c.choose(p,this);i(l);a(p).val(c.transfer(this)).focus()});g(l);setTimeout(d,0);m=false;a(p).prop({readonly:false});c.searchEnd(p)};if(c.cache&&(n[p.value]!==undefined)){if(!a.isEmptyObject(n[p.value])){q(n[p.value])}else{m=false;a(p).prop({readonly:false});c.searchEnd(p)}return}c.autofill(p,function(u){if((typeof u!=="object")||(u===undefined)||a.isEmptyObject(u)){m=false;a(p).prop({readonly:false});c.searchEnd(p);if(c.cache){n[p.value]=[]}return}if(c.limit){var t=u instanceof Array?u.length:Object.keys(u).length;if(t>c.limit){var s=0;for(var r in u){s++;if(s>c.limit){delete u[r]}}}}if(c.cache){n[p.value]=u}q(u)})},c.timeout)})}).keydown(function(y){var n,B=a(this).data(),m=a(this).next(),w=a(this).parent(),l=m.find(".shac-item").length,x=(y.keyCode===13),k=(y.keyCode===27),z=(y.keyCode===38),v=(y.keyCode===40);if(x){if(B.active===undefined){return true}var p=m.find(".shac-item").eq(B.active);if(c.debug){console.log(p.data())}c.choose(this,p);a(this).val(c.transfer(p));i(w);return false}if(k){i(w);return}if(z){if(B.active===undefined){n=l-1}else{n=B.active;n--;if(n<0){n=l-1}}}if(v){if(B.active===undefined){n=0}else{n=B.active;n++;if(n>=l){n=0}}}if(z||v){var r=m.find(".shac-item").eq(n),s=m.innerHeight(),q=m.scrollTop(),A=m.prop("scrollHeight"),C=r.position().top+q,u=r.outerHeight(),o=C+u+b,t=C-b;a(this).data({active:n});m.find(".shac-item").removeClass("key-active");r.addClass("key-active");if(A>s){m.scrollTop(z?t:(o-s))}return false}}).next(".shac-menu").on("mousewheel.shac DOMMouseScroll.shac",function(m){if(this.scrollHeight<a(this).innerHeight()){return}var n=m.wheelDelta||(m.originalEvent&&m.originalEvent.wheelDelta)||-m.detail,k=(this.scrollTop+a(this).outerHeight()-this.scrollHeight)>=0,l=this.scrollTop<=0;if((k&&(n<0))||(l&&(n>0))){m.preventDefault()}})}})(jQuery);